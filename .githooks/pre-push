#!/usr/bin/env bash
# Optional: prevent accidentally pushing vault or secrets.
# Install: git config core.hooksPath .githooks && chmod +x .githooks/pre-push
# Pre-push reads refs from stdin: remote_ref remote_sha local_ref local_sha

blocked=0
while read -r remote_ref remote_sha local_ref local_sha; do
  [[ -z "$local_sha" || "$local_sha" == "0"* ]] && continue
  names=$(git diff --name-only "$remote_sha" "$local_sha" 2>/dev/null)
  if echo "$names" | grep -qE 'zoraasi_export|ZoraASI|credentials\.json|\.env'; then
    echo "pre-push: Blocked â€” vault or secrets would be pushed. Unstage or remove from commit."
    blocked=1
    break
  fi
done
[[ $blocked -eq 1 ]] && exit 1
exit 0
